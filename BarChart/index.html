<!DOCTYPE html>

<head>
    <meta charset='utf-8'>
    <script src='https://d3js.org/d3.v4.min.js'></script>
</head>

<body>
    <div id='chart'></div>
</body>

<script>
    d3.json('/Scrapper/results.json', function (error, data) {
        drawGraph(data);
    });


    function drawGraph(data) {
        var data = data.filter(function (v) {
            return v.bandName != null
        });

        var entries = d3.nest()
            .key(function (d) {
                return d.bandName.charAt(0)
            })
            .rollup(function (v) {
                return v.length
            })
            .entries(data);

        const svgBackgroundColor = 'grey'
        const barFillColor = 'black'
        const fontFamily = 'helvetica'

        const margin = {
            top: 50,
            right: 40,
            bottom: 50,
            left: 40
        }
        const width = 800 - margin.left - margin.right
        const height = 800 - margin.top - margin.bottom

        var svg = d3.select('#chart')
            .append('svg')
            .attr('width', width)
            .attr('height', height)
            .style('background-color', svgBackgroundColor)
            .append('g')
            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')

        var barChart = svg.append('g');
        const chartWidth = width- (width/4);
        const chartHeight = height / 2;

        var letters = entries.map(d => d.key).sort()
        var maxCount = d3.max(entries, function(d){return d.value});
        var minCount = d3.min(entries, function(d){return d.value});

        var x = d3.scaleBand()
            .range([0, chartWidth])
            .domain(letters)

        var xAxis = barChart.append('g')
            .classed('axis--x', true)
            .call(d3.axisBottom(x))
            .style('font-size', '.3em')
            .style('font-weight', 'regular')
            .style('font-family', fontFamily)
            .attr('transform', 'translate(0,' + chartHeight + ')');

        var y = d3.scaleLinear()
            .domain([minCount, maxCount])
            .range([chartHeight,0])

        var yAxis = barChart.append('g')
            .classed('axis--y', true)
            .call(d3.axisLeft(y))
            .style('font-size', '.3em')
            .style('font-weight', 'regular')
            .style('font-family', fontFamily)

        barChart.selectAll('rect')
            .data(entries)
			.enter().append('rect')
			.attr('fill', barFillColor)
			.attr('x', d => x(d.key))
			.attr('y', d => y(d.value))
			.attr('rx', 1)
			.attr('width', x.bandwidth())
			.attr('height', d => chartHeight - y(d.value))
            

        console.log(entries)

    }
</script>